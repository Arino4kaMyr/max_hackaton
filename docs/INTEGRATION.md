# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ Prisma (`prisma/schema.prisma`)

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö:

**User:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `chatId` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID —á–∞—Ç–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã `createdAt` –∏ `updatedAt`

**Task:**
- ‚úÖ `deadline` ‚Üí `dueDate` (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–æ—Ç—É)
- ‚úÖ –£–±—Ä–∞–Ω–æ –ø–æ–ª–µ `completed` (–≤ –±–æ—Ç–µ –µ–≥–æ –Ω–µ—Ç)
- ‚úÖ –£–±—Ä–∞–Ω–æ `updatedAt` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**Event:**
- ‚úÖ `startTime`/`endTime` ‚Üí `datetime` (–æ–¥–Ω–æ –ø–æ–ª–µ, –∫–∞–∫ –≤ –±–æ—Ç–µ)
- ‚úÖ `reminderSent` ‚Üí `reminderMinutes` (—Ö—Ä–∞–Ω–∏–º –º–∏–Ω—É—Ç—ã –¥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)
- ‚úÖ –£–±—Ä–∞–Ω–æ `endTime`

**UserSettings (–±—ã–ª–æ Setting):**
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–æ —Å key-value –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è:
  - `dailyDigest` (Boolean)
  - `reminderMinutesBeforeEvent` (Int)
  - `timezone` (String)
- ‚úÖ –û–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É —Å User (—á–µ—Ä–µ–∑ `userId` unique)

#### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞:

**PomodoroSession:**
- `id` - UUID
- `userId` - —Å–≤—è–∑—å —Å User
- `taskId` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å —Å Task
- `workMinutes` - –º–∏–Ω—É—Ç—ã —Ä–∞–±–æ—Ç—ã
- `breakMinutes` - –º–∏–Ω—É—Ç—ã –ø–µ—Ä–µ—Ä—ã–≤–∞
- `cycles` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤
- `currentCycle` - —Ç–µ–∫—É—â–∏–π —Ü–∏–∫–ª
- `isActive` - –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ —Å–µ—Å—Å–∏—è
- `startedAt` - –∫–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∞—Å—å
- `completedAt` - –∫–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å

### 2. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

**`src/database/repositories/pomodoroRepository.js`**
- `create()` - —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
- `findActiveByUserId()` - –Ω–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `update()` - –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é
- `complete()` - –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é

**`src/database/repositories/userSettingsRepository.js`**
- `createOrUpdate()` - —Å–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `findByUserId()` - –ø–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å –¥–µ—Ñ–æ–ª—Ç–∞–º–∏)
- `update()` - –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

- **TaskRepository**: —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `dueDate` –≤–º–µ—Å—Ç–æ `deadline`
- **EventRepository**: —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `datetime` –∏ `reminderMinutes`
- **UserRepository**: –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `createOrFind()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. –°–æ–∑–¥–∞–Ω –∞–¥–∞–ø—Ç–µ—Ä `bot/src/dbStore.js`

–≠—Ç–æ—Ç —Ñ–∞–π–ª –∑–∞–º–µ–Ω—è–µ—Ç `store.js` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Prisma —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤–º–µ—Å—Ç–æ –ø–∞–º—è—Ç–∏.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å API –±–æ—Ç–∞
- ‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç UUID –∏–∑ –ë–î –≤ —á–∏—Å–ª–æ–≤—ã–µ ID –¥–ª—è –±–æ—Ç–∞ (1, 2, 3...)
- ‚úÖ –°–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–æ–Ω–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ)
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL

## üîó –ö–∞–∫ —Å–≤—è–∑–∞—Ç—å –±–æ—Ç–∞ —Å –ë–î

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install
cd bot
npm install
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# PostgreSQL
DATABASE_URL="postgresql://user:password@localhost:5432/productivity_bot?schema=public"

# –ë–æ—Ç
BOT_TOKEN=your_bot_token_here
TIMEZONE=Europe/Moscow
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma Client
npm run prisma:generate

# –°–æ–∑–¥–∞–π—Ç–µ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npm run migrate
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –±–æ—Ç–∞ –Ω–∞ –ë–î

–í —Ñ–∞–π–ª–µ `bot/src/bot.js` —É–∂–µ –∏–∑–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç:

```javascript
// –ë—ã–ª–æ:
// import store from './store.js';

// –°—Ç–∞–ª–æ:
import store from './dbStore.js';
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

```bash
cd bot
npm start
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `store.js` (in-memory), –∏—Ö –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:

1. **–≠–∫—Å–ø–æ—Ä—Ç –∏–∑ –ø–∞–º—è—Ç–∏** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
   - –î–æ–±–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `store.js`

2. **–ò–º–ø–æ—Ä—Ç –≤ –ë–î**:
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ID –∑–∞–¥–∞—á –∏ —Å–æ–±—ã—Ç–∏–π

–í –±–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–∏—Å–ª–æ–≤—ã–µ ID (1, 2, 3...), –∞ –≤ –ë–î - UUID. 

`dbStore.js` —Ä–µ—à–∞–µ—Ç —ç—Ç–æ —Ç–∞–∫:
- –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏: –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç UUID –≤ –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ (1, 2, 3...)
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–π UUID –≤ –ø–æ–ª–µ `_dbId`
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `_dbId` –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –ë–î

### –°–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤

–°–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á/—Å–æ–±—ã—Ç–∏–π) –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏:
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ (–∂–∏–≤—É—Ç —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –¥–∏–∞–ª–æ–≥–∞)
- –ù–µ –∫—Ä–∏—Ç–∏—á–Ω—ã (–ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–µ—Ç—Å—è –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥)

### Pomodoro —Å–µ—Å—Å–∏–∏

Pomodoro —Å–µ—Å—Å–∏–∏ —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î, –Ω–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã –≤—Å–µ –µ—â–µ –≤ –ø–∞–º—è—Ç–∏ (`PomodoroManager`).

–î–ª—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ:
1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –≤ –ë–î –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
2. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `cd bot && npm start`
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î:
   ```bash
   npm run prisma:studio
   ```
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –ë–î –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞
2. ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–æ—Ç–∞
3. ‚úÖ `dbStore.js` —Å–æ–∑–¥–∞–Ω –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
4. ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å async –º–µ—Ç–æ–¥–∞–º–∏
5. ‚úÖ `notifications.js` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á/—Å–æ–±—ã—Ç–∏–π
2. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Pomodoro —Å–µ—Å—Å–∏–∏
3. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏)

